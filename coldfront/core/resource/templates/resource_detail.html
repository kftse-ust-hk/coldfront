{% extends "common/base.html" %}
{% load crispy_forms_tags %}
{% load static %}


{% block title %}
Resource Detail
{% endblock %}


{% block content %}
<div class="max-w-7xl mx-auto">
  <!-- Page Title -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-primary-950">Resource Detail</h1>
    <div class="mt-2 h-1 w-16 bg-secondary-500 rounded"></div>
  </div>

  <!-- Resource Information -->
  <div class="bg-white border border-gray-200 rounded-lg shadow-sm mb-6">
    <div class="px-6 py-4 border-b border-gray-200">
      <h3 class="text-lg font-semibold text-gray-900 flex items-center">
        <i class="fas fa-list text-primary-600 mr-3" aria-hidden="true"></i> 
        Resource Information
      </h3>
    </div>
    
    <div class="p-6">
        {% csrf_token %}
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <tbody class="bg-white divide-y divide-gray-200">
              <tr class="hover:bg-gray-50">
                <th scope="row" class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Name:</th>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ resource.name }}</td>
              </tr>
              <tr class="hover:bg-gray-50">
                <th scope="row" class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Description:</th>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ resource.description }}</td>
              </tr>
              <tr class="hover:bg-gray-50">
                <th scope="row" class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Resource Type:</th>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ resource.resource_type }}</td>
              </tr>
              <tr class="hover:bg-gray-50">
                <th scope="row" class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Parent Resource:</th>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                  {% if resource.parent_resource %}
                    <a href="{% url 'resource-detail' resource.parent_resource.pk %}" class="text-primary-600 hover:text-primary-900">
                      {{ resource.parent_resource }}
                    </a>
                  {% else %}
                    {{ resource.parent_resource }}
                  {% endif %}
                </td>
          </tr>
          <tr>
              <tr class="hover:bg-gray-50">
                <th scope="row" class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Linked Resources:</th>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                {% if resource.linked_resources.all %}
                  {% for resource in resource.linked_resources.all %}
                    <a href="{% url 'resource-detail' resource.pk %}" class="text-primary-600 hover:text-primary-900">{{ resource }}</a> <br>
                  {% endfor %}
                {% else %}
                  None
                {% endif %}
                </td>
              </tr>
              <tr class="hover:bg-gray-50">
                <th scope="row" class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Public/Private:</th>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                  {% if resource.is_public %}
                    Public
                  {% else %}
                    Private
                  {% endif %}
                </td>
              </tr>
            </tbody>
          </table>
        </div>
    </div>
  </div>

  <!-- Start Resource Attributes -->
  {% if attributes or request.user.is_superuser %}
    <div class="bg-white border border-gray-200 rounded-lg shadow-sm mb-6">
      <div class="px-6 py-4 border-b border-gray-200">
        <div class="flex items-center justify-between">
          <h3 class="text-lg font-semibold text-gray-900 flex items-center">
            <i class="fas fa-info-circle text-primary-600 mr-3" aria-hidden="true"></i> 
            Resource Attributes
          </h3>
          {% if request.user.is_superuser %}
            <div class="flex gap-3">
              <a href="{% url 'resource-attribute-add' resource.pk %}" class="inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors duration-200">
                <i class="fas fa-plus mr-2" aria-hidden="true"></i>
                Add Attribute
              </a>
              <a href="{% url 'resource-attribute-delete' resource.pk %}" class="inline-flex items-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors duration-200">
                <i class="fas fa-minus mr-2" aria-hidden="true"></i>
                Delete Attributes
              </a>
            </div>
          {% endif %}
        </div>
      </div>
      <div class="p-6">
        {% if attributes %}
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Attribute</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Value</th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                {% for attribute in attributes %}
                    <tr class="hover:bg-gray-50">
                      <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{attribute.resource_attribute_type.name}}</td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{attribute.value}}</td>
                    </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <div class="bg-blue-50 border border-blue-200 rounded-md p-4" role="alert">
            <div class="flex">
              <i class="fas fa-info-circle text-blue-400 mt-0.5 mr-3" aria-hidden="true"></i>
              <div class="text-sm text-blue-700">There are no attributes to display.</div>
            </div>
          </div>
        {% endif %}
      </div>
    </div>
  {% endif %}

  <!-- Start Child Resources -->
  <div class="bg-white border border-gray-200 rounded-lg shadow-sm mb-6">
    <div class="px-6 py-4 border-b border-gray-200">
      <h3 class="text-lg font-semibold text-gray-900 flex items-center">
        <i class="fas fa-info-circle text-primary-600 mr-3" aria-hidden="true"></i> 
        Child Resources
      </h3>
    </div>

    <div class="p-6">
    {% if child_resources %}
      <div class="overflow-x-auto">
        <table id="child_resource_table" class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Resource Name</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">WarrantyExpire</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ServiceEnd</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Vendor</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Serial #</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Model</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            {% for child in child_resources %}
                <tr class="hover:bg-gray-50">
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                    <a href="{% url 'resource-detail' child.object.pk %}" class="text-primary-600 hover:text-primary-900">{{child.object}}</a>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{child.WarrantyExpirationDate}}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{child.ServiceEnd}}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{child.Vendor}}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{child.SerialNumber}}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{child.Model}}</td>
                </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
        <div class="bg-blue-50 border border-blue-200 rounded-md p-4" role="alert">
          <div class="flex">
            <i class="fas fa-info-circle text-blue-400 mt-0.5 mr-3" aria-hidden="true"></i>
            <div class="text-sm text-blue-700">There are no child resources to display.</div>
          </div>
        </div>
          <i class="fas fa-info-circle" aria-hidden="true"></i>
          There are no child resources to display.
        </div>
      {% endif %}
    </div>
  </div>
</div>

<script>
  $(document).ready(function () { 
    $('#child_resource_table').DataTable({
      lengthMenu: [5, 10, 20, 50, 100],
      "pageLength": 5,
      "ordering": false,
      'aoColumnDefs': [{
        'bSortable': false,
        'aTargets': ['nosort']
      }]
    });
  });
</script>
{% endblock %}
